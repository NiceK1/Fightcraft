# Fightcraft

An AI-powered 2D crafting and combat game built with Pygame. Craft unique items using a Minecraft-style workbench, where both sprites and item stats are generated by AI based on your material combinations!

## Features

- **AI-Powered Sprite Generation**: Items sprites are generated using AI based on the materials you combine
- **AI-Powered Stats Generation**: Item properties and stats are procedurally generated with AI
- **Minecraft-Style Crafting**: 3x3 crafting grid with predefined recipes
- **Weapon Type Selection**: Choose between sword, axe, or spear when crafting weapons
- **Item Info System**: View detailed item descriptions and effects via info button popup
- **Equipment System**: Equip weapons, armor, and buffs/concoctions
- **Turn-Based Combat**: Fight enemies using your crafted items with real-time active effects display
- **Active Effects Tracking**: See all status effects, durations, and stack counts during combat
- **Intelligent Caching**: Generated sprites and stats are cached for instant reuse
- **Fallback System**: Works without AI backend using procedural generation

## Project Structure

```
Fightcraft/
‚îú‚îÄ‚îÄ main.py                     # Game entry point
‚îú‚îÄ‚îÄ requirements.txt            # Python dependencies
‚îú‚îÄ‚îÄ README.md                   # This file
‚îú‚îÄ‚îÄ game/                       # Core game code
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ engine.py              # Game engine and main loop
‚îÇ   ‚îú‚îÄ‚îÄ item.py                # Item system and recipes
‚îÇ   ‚îú‚îÄ‚îÄ inventory.py           # Inventory management
‚îÇ   ‚îú‚îÄ‚îÄ crafting.py            # Crafting system
‚îÇ   ‚îú‚îÄ‚îÄ combat.py              # Combat system
‚îÇ   ‚îú‚îÄ‚îÄ scenes.py              # Game scenes (menu, crafting, combat)
‚îÇ   ‚îî‚îÄ‚îÄ ai_client.py           # AI backend client
‚îú‚îÄ‚îÄ ai_backend/                # AI generation backend
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ server.py              # FastAPI server
‚îÇ   ‚îú‚îÄ‚îÄ sprite_gen.py          # Sprite generation (ComfyUI/fallback)
‚îÇ   ‚îú‚îÄ‚îÄ stats_gen.py           # Stats generation (GPT-4/fallback)
‚îÇ   ‚îî‚îÄ‚îÄ cache.py               # Caching system
‚îî‚îÄ‚îÄ assets/
    ‚îî‚îÄ‚îÄ cache/                 # Generated sprites cache
```

## Installation

### Prerequisites

- Python 3.9 or higher
- pip package manager

### Basic Setup (Fallback Mode)

This will run the game with procedural generation (no external AI services needed):

```bash
# Clone or navigate to the project directory
cd Fightcraft

# Install dependencies
pip install -r requirements.txt

# Run the AI backend (uses fallback generation)
python ai_backend/server.py
```

In a separate terminal:

```bash
# Run the game
python main.py
```

### Advanced Setup (AI Mode)

For full AI-powered sprite and stats generation:

#### Option 1: ComfyUI + SDXL-Turbo (Recommended)

1. **Install ComfyUI**:
   ```bash
   git clone https://github.com/comfyanonymous/ComfyUI.git
   cd ComfyUI
   pip install -r requirements.txt
   ```

2. **Download SDXL-Turbo model**:
   - Download from [Hugging Face](https://huggingface.co/stabilityai/sdxl-turbo)
   - Place in `ComfyUI/models/checkpoints/`

3. **Run ComfyUI**:
   ```bash
   python main.py --listen 0.0.0.0 --port 8188
   ```

4. **Configure Fightcraft backend**:
   - The backend will automatically detect ComfyUI at `http://localhost:8188`

#### Option 2: OpenAI API (For Stats Generation)

1. **Get OpenAI API key**:
   - Sign up at [OpenAI](https://openai.com)
   - Create an API key

2. **Set environment variable**:
   ```bash
   # Windows
   set OPENAI_API_KEY=your_api_key_here

   # Linux/Mac
   export OPENAI_API_KEY=your_api_key_here
   ```

3. **Enable in backend**:
   Edit `ai_backend/server.py` line 13:
   ```python
   stats_gen = StatsGenerator(use_openai=True)  # Change to True
   ```

## How to Play

### Main Menu
- Use **Arrow Keys** to navigate
- Press **Enter** to select
- Choose "Start Game" to begin crafting

### Crafting Scene
1. **Select Tab**: Switch between Weapon, Armor, and Concoction tabs
2. **Choose Weapon Type** (Weapon tab only): Select sword, axe, or spear using radio buttons
3. **Drag and Drop Materials**: Click and drag materials from your inventory to the 3x3 crafting grid
4. **Craft Items**: Place exactly 3 materials in the grid to enable crafting
5. **Generate with AI**: Click "Craft Item" button - AI will generate unique sprite and stats
6. **View Item Info**: Click the info button (i) next to crafted items to see detailed descriptions
7. **Equip Items**: Drag crafted items to equipment slots (Weapon, Armor, Buff)
8. **Start Combat**: Press **ESC** when ready to fight

### Combat Scene
- Press **SPACE** to execute next turn
- Press **A** to toggle auto-combat (automatic turns)
- **Active Effects**: View all status effects with durations and stack counts below health bars
- Press **ESC** to return to crafting

## Crafting Recipes

The game includes several pre-defined recipes. You need exactly 3 materials:

### Weapons
- Iron Ingot + Oak Wood + Crystal Shard
- Dragon Scale + Dark Stone + Magic Essence
- Iron Ingot + Iron Ingot + Oak Wood

### Armor
- Iron Ingot + Leather + Dark Stone
- Dragon Scale + Gold Bar + Crystal Shard
- Leather + Leather + Iron Ingot

### Concoctions (Buffs)
- Magic Essence + Crystal Shard + Dragon Scale
- Oak Wood + Magic Essence + Leather
- Crystal Shard + Crystal Shard + Magic Essence

## Architecture

### Game Flow
```
Main Menu ‚Üí Crafting Scene ‚Üí Combat Scene ‚Üí Crafting Scene ‚Üí ...
```

### AI Generation Pipeline
```
Game (Pygame)
    ‚Üì HTTP Request
AI Backend (FastAPI)
    ‚Üì
Check Cache ‚Üí If miss ‚Üí Generate with AI
    ‚Üì                         ‚Üì
Return cached data      ComfyUI/GPT-4
                             ‚Üì
                        Cache result
                             ‚Üì
                        Return new data
```

### Caching System
- **Memory Cache**: LRU cache for recently generated sprites (100 items)
- **Disk Cache**: Persistent cache in `assets/cache/`
- **Stats Cache**: JSON file storing generated stats

## Configuration

### Backend Configuration

Edit `ai_backend/server.py`:

```python
# ComfyUI URL
sprite_gen = SpriteGenerator(comfy_url="http://localhost:8188")

# Enable/disable OpenAI
stats_gen = StatsGenerator(use_openai=False)
```

### Game Configuration

Edit `main.py`:

```python
# Window size
game = GameEngine(width=1280, height=720, title="Fightcraft")
```

Edit `game/ai_client.py`:

```python
# Backend URL
AIClient(backend_url="http://localhost:8000")
```

## Development

### Running in Development Mode

Terminal 1 - Backend with auto-reload:
```bash
uvicorn ai_backend.server:app --reload --host 0.0.0.0 --port 8000
```

Terminal 2 - Game:
```bash
python main.py
```

### Adding New Materials

Edit `game/item.py` in the `create_base_materials()` function:

```python
material_defs = [
    ("Your Material", (R, G, B)),  # Add new material
    # ...
]
```

### Adding New Recipes

Edit `game/item.py` in the `RECIPES` list:

```python
RECIPES = [
    Recipe(["Material1", "Material2", "Material3"], ItemType.WEAPON),
    # Add new recipe
]
```

## Troubleshooting

### Backend Not Connecting
- Ensure backend is running: `python ai_backend/server.py`
- Check console for error messages
- Game will use fallback generation if backend is offline

### ComfyUI Not Working
- Verify ComfyUI is running at `http://localhost:8188`
- Check ComfyUI console for errors
- Backend will fall back to procedural sprites if ComfyUI fails

### Performance Issues
- Disable OpenAI: Set `use_openai=False` in `server.py`
- Reduce cache size: Edit `cache.py` memory_size parameter
- Lower game resolution: Edit window size in `main.py`

### Missing Dependencies
```bash
pip install --upgrade -r requirements.txt
```

## API Documentation

Once the backend is running, visit:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### Key Endpoints

#### POST /generate_sprite
Generate item sprite from materials.

Request:
```json
{
  "materials": ["Iron Ingot", "Oak Wood", "Crystal Shard"],
  "item_type": "weapon",
  "seed": 12345,
  "weapon_subtype": "sword"
}
```

Parameters:
- `materials`: Array of material names
- `item_type`: "weapon", "armor", or "concoction"
- `seed` (optional): Random seed for reproducible generation
- `weapon_subtype` (optional): "sword", "axe", or "spear" for weapons

Response: PNG image (binary)

#### POST /generate_stats
Generate item stats from materials.

Request:
```json
{
  "materials": ["Iron Ingot", "Oak Wood", "Crystal Shard"],
  "item_type": "weapon",
  "weapon_subtype": "sword"
}
```

Parameters:
- `materials`: Array of material names
- `item_type`: "weapon", "armor", or "concoction"
- `weapon_subtype` (optional): "sword", "axe", or "spear" for weapons

Response:
```json
{
  "name": "Crystal Iron Blade",
  "damage": 45,
  "armor": 0,
  "health": 0,
  "speed": 1.2,
  "effect_type": "lifesteal",
  "effect_power": 0.3,
  "special_effect": "Deals bonus magical damage",
  "rarity": "rare",
  "description": "A powerful sword forged from Iron Ingot, Oak Wood, Crystal Shard."
}
```

## Future Enhancements

- [ ] More crafting recipes and materials
- [ ] Multiple enemy types
- [ ] Save/load game state
- [ ] Multiplayer crafting competitions
- [ ] Item enchantment system
- [ ] Quest system
- [ ] Sound effects and music
- [ ] Custom AI model fine-tuning for game-specific sprites

## License

This project is provided as-is for educational and entertainment purposes.

## Credits

- Built with [Pygame](https://www.pygame.org/)
- Backend powered by [FastAPI](https://fastapi.tiangolo.com/)
- AI integration: [ComfyUI](https://github.com/comfyanonymous/ComfyUI), [OpenAI](https://openai.com)
- Created by Claude (Anthropic AI Assistant)

## Contributing

Feel free to fork and enhance! Some ideas:
- Add new crafting recipes
- Improve AI prompts for better sprites
- Create new game modes
- Add particle effects
- Implement skill trees

Enjoy crafting and fighting! üó°Ô∏èüõ°Ô∏è‚öóÔ∏è
